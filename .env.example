# Example environment variable file for MailJaeger
# Copy this file to .env and configure with your settings

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# API Authentication Key (REQUIRED for production)
# Multiple keys: comma-separated values for key rotation support
# Generate with: python -c 'import secrets; print(secrets.token_urlsafe(32))'
# Leave empty to disable authentication (NOT RECOMMENDED for production)
API_KEY=

# API Key File (alternative to API_KEY environment variable)
# Path to file containing API keys (one per line, lines starting with # are ignored)
# Example: /run/secrets/mailjaeger_api_keys
API_KEY_FILE=

# Reverse Proxy Configuration
# Set to true if running behind a trusted reverse proxy (Nginx, Caddy, Traefik)
# When true, honors X-Forwarded-For and X-Forwarded-Proto headers
# WARNING: Only enable if your reverse proxy is properly configured to set these headers
TRUST_PROXY=false

# Server Configuration
# Use 127.0.0.1 (localhost only) for local deployment
# Use 0.0.0.0 to expose externally (REQUIRES API_KEY for security)
SERVER_HOST=127.0.0.1
SERVER_PORT=8000

# Allowed Host Headers (runtime enforcement)
# Comma-separated list of allowed hostnames (without scheme or port)
# Examples: example.com,api.example.com,www.example.com
# - Empty (default): No host validation, accepts any Host header
# - Set: Only listed hosts are accepted; rejects others with HTTP 400
# - When TRUST_PROXY=true: Uses X-Forwarded-Host if present, otherwise Host header
# - Ports are ignored during matching (example.com:443 matches example.com)
ALLOWED_HOSTS=

# CORS Configuration
# Comma-separated list of allowed origins for CORS
# Default: localhost only (secure default)
CORS_ORIGINS=http://localhost:8000,http://127.0.0.1:8000

# ============================================================================
# IMAP CONFIGURATION
# ============================================================================

IMAP_HOST=imap.gmail.com
IMAP_PORT=993
IMAP_USERNAME=your_email@gmail.com
IMAP_PASSWORD=your_app_password

# For Gmail: Create an App Password at https://myaccount.google.com/apppasswords
# For Outlook/Office365: Use your account password or app password
# SECURITY: Never commit real credentials to version control

# ============================================================================
# AI CONFIGURATION (Ollama)
# ============================================================================

# Ollama endpoint (local by default)
AI_ENDPOINT=http://localhost:11434

# AI Model - Recommended models for Raspberry Pi 5 (16GB RAM):
#   - mistral:7b-instruct-q4_0 (~4GB, best quality/performance balance)
#   - phi3:mini (~2-3GB, most efficient)
#   - llama3.2:3b (~2-3GB, good alternative)
AI_MODEL=mistral:7b-instruct-q4_0
AI_TIMEOUT=120

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# SQLite database path (automatically created in data directory)
DATABASE_URL=sqlite:///./data/mailjaeger.db

# ============================================================================
# EMAIL PROCESSING CONFIGURATION
# ============================================================================

# Spam detection threshold (0.0-1.0)
SPAM_THRESHOLD=0.7

# Maximum emails to process per run
MAX_EMAILS_PER_RUN=200

# ============================================================================
# MAIL ACTION SAFETY CONTROLS
# ============================================================================

# Safe Mode: When enabled, performs analysis but NO destructive IMAP actions
# Recommended: true for first-time setup, false after testing
SAFE_MODE=true

# Require Approval: Queue actions for manual approval before applying
# When true, all IMAP actions go to pending_actions table for review
# When false, actions are applied immediately (subject to SAFE_MODE)
REQUIRE_APPROVAL=false

# FAIL-CLOSED SAFETY REQUIREMENT:
# Web-exposed deployments (SERVER_HOST=0.0.0.0, TRUST_PROXY=true, or ALLOWED_HOSTS set)
# MUST have at least one safety control enabled:
# - Set SAFE_MODE=true (recommended for internet-facing instances), OR
# - Set REQUIRE_APPROVAL=true (actions require manual approval)
# The application will refuse to start if web-exposed with both safety controls disabled.

# Allow Destructive IMAP Operations (DELETE/EXPUNGE)
# When false (default), DELETE actions are blocked with REJECTED status
# Set to true only if you understand the risks and want to allow permanent deletion
# WARNING: Deleted emails may not be recoverable depending on mail server configuration
ALLOW_DESTRUCTIVE_IMAP=false

# Maximum Actions Per Request
# Safety limit to prevent accidental "apply all" operations
# Default: 20 (actions requiring preview token before applying)
MAX_APPLY_PER_REQUEST=20

# Mark processed emails as read (false = keeps them unread)
MARK_AS_READ=false

# Delete spam emails (false = moves to quarantine folder instead)
# CAUTION: Deletion may be irreversible depending on mail server
# Note: DELETE actions also require ALLOW_DESTRUCTIVE_IMAP=true
DELETE_SPAM=false

# Quarantine folder for suspected spam (used when DELETE_SPAM=false)
QUARANTINE_FOLDER=Quarantine

# Safety Review Folder
# Additional folder for actions requiring review
# All MOVE actions are restricted to configured safe folders only
SAFETY_REVIEW_FOLDER=MailJaeger/Review

# ============================================================================
# FOLDER CONFIGURATION
# ============================================================================

INBOX_FOLDER=INBOX
ARCHIVE_FOLDER=Archive
SPAM_FOLDER=Spam

# ============================================================================
# SCHEDULING CONFIGURATION
# ============================================================================

# Daily processing time (HH:MM format, 24-hour)
SCHEDULE_TIME=08:00

# Timezone for scheduling
SCHEDULE_TIMEZONE=Europe/Berlin

# ============================================================================
# LEARNING SYSTEM
# ============================================================================

# Enable learning from user behavior
LEARNING_ENABLED=true

# Confidence threshold for automated folder routing (0.0-1.0)
LEARNING_CONFIDENCE_THRESHOLD=0.8

# ============================================================================
# STORAGE & PRIVACY CONFIGURATION
# ============================================================================

# Store full email body in database
# PRIVACY WARNING: Disabled by default for data minimization
# Enable only if you need full-text search on email content
STORE_EMAIL_BODY=false

# Store email attachments
# CAUTION: May consume significant disk space
STORE_ATTACHMENTS=false

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Log file path (automatically created in data/logs directory)
LOG_FILE=./data/logs/mailjaeger.log

# Debug Mode
# PRODUCTION WARNING: DEBUG must be false in production/web-exposed deployments
# When DEBUG=true, detailed error messages and stack traces are exposed in logs and API responses
# This can leak sensitive information (credentials, internal paths, etc.)
# The application will refuse to start if DEBUG=true when:
#   - SERVER_HOST=0.0.0.0 (externally accessible), OR
#   - TRUST_PROXY=true (behind reverse proxy), OR
#   - ALLOWED_HOSTS is set (indicating internet-facing deployment)
# For local development only - always set to false for production
# Never run DEBUG=true on an internet-facing host; app will refuse to start.
DEBUG=false

# ============================================================================
# SAFE DEPLOYMENT CHECKLIST
# ============================================================================
#
# For Internet-Facing/Production Deployments:
# -------------------------------------------
# 1. ✓ Set DEBUG=false (required for web-exposed)
# 2. ✓ Set API_KEY with strong, randomly generated key(s)
# 3. ✓ Enable at least ONE safety control:
#      - SAFE_MODE=true (recommended), OR
#      - REQUIRE_APPROVAL=true (manual review required)
# 4. ✓ Keep ALLOW_DESTRUCTIVE_IMAP=false (unless you need DELETE)
# 5. ✓ Set MAX_APPLY_PER_REQUEST to reasonable limit (default: 20)
# 6. ✓ Configure ALLOWED_HOSTS for your domain(s) if applicable
# 7. ✓ Set TRUST_PROXY=true only if behind properly configured reverse proxy
#
# Safety Features:
# ----------------
# - Fail-closed: Web-exposed requires SAFE_MODE=true OR REQUIRE_APPROVAL=true
# - Two-step apply: Preview generates token; apply requires token (5 min expiry)
# - DELETE blocked: Destructive operations disabled unless explicitly enabled
# - Folder allowlist: MOVE actions restricted to safe folders only
# - Apply limits: Max actions per request to prevent accidental bulk operations
#
# Testing Locally:
# ----------------
# - SERVER_HOST=127.0.0.1 (localhost only)
# - SAFE_MODE=true (test without IMAP changes)
# - REQUIRE_APPROVAL=false (or true to test approval workflow)
# - DEBUG=true (safe for localhost development only)
#
